{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Restaurant Dashboard{% endblock title %}

{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
  <!-- Orders Overview -->
  <div class="row">
    <div class="col-lg-8 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Current Orders</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Order #</th>
                  <th>Table</th>
                  <th>Items</th>
                  <th>Status</th>
                  <th>Time</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for order in active_orders %}
                <tr>
                  <td>#{{ order.id }}</td>
                  <td>{% if order.table %}{{ order.table.number }}{% else %}{{ order.order_type }}{% endif %}</td>
                  <td>{{ order.items.count }}</td>
                  <td><span class="badge bg-{{ order.get_status_color }}">{{ order.get_order_status_display }}</span></td>
                  <td>{{ order.order_date|timesince }}</td>
                  <td>
                    <button class="btn btn-sm btn-primary">View</button>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Table Status -->
    <div class="col-lg-4 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Table Status</h5>
        </div>
        <div class="card-body">
          <div class="table-status-grid">
            {% for table in tables %}
            <div class="table-status-item {{ table.status|lower }}" data-table-id="{{ table.id }}">
              <div class="table-number">{{ table.number }}</div>
              <div class="table-capacity">{{ table.capacity }} seats</div>
              <div class="table-status-badge">{{ table.get_status_display }}</div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics -->
  <div class="row">
    <div class="col-sm-6 col-lg-3 mb-4">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="card-info">
              <p class="card-text">Today's Sales</p>
              <div class="d-flex align-items-end mb-2">
                <h4 class="card-title mb-0">${{ today_sales }}</h4>
              </div>
            </div>
            <div class="card-icon">
              <span class="badge bg-label-success rounded p-2">
                <i class='bx bx-dollar bx-sm'></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-sm-6 col-lg-3 mb-4">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="card-info">
              <p class="card-text">Orders Today</p>
              <div class="d-flex align-items-end mb-2">
                <h4 class="card-title mb-0">{{ orders_today }}</h4>
              </div>
            </div>
            <div class="card-icon">
              <span class="badge bg-label-primary rounded p-2">
                <i class='bx bx-receipt bx-sm'></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-sm-6 col-lg-3 mb-4">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="card-info">
              <p class="card-text">Average Order Time</p>
              <div class="d-flex align-items-end mb-2">
                <h4 class="card-title mb-0">{{ avg_preparation_time }}min</h4>
              </div>
            </div>
            <div class="card-icon">
              <span class="badge bg-label-warning rounded p-2">
                <i class='bx bx-time bx-sm'></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-sm-6 col-lg-3 mb-4">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="card-info">
              <p class="card-text">Popular Items</p>
              <div class="d-flex align-items-end mb-2">
                <h4 class="card-title mb-0">{{ popular_items_count }}</h4>
              </div>
            </div>
            <div class="card-icon">
              <span class="badge bg-label-info rounded p-2">
                <i class='bx bx-dish bx-sm'></i>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity and Popular Items -->
  <div class="row">
    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Popular Items</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-borderless">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Category</th>
                  <th>Orders</th>
                  <th>Revenue</th>
                </tr>
              </thead>
              <tbody>
                {% for item in popular_items %}
                <tr>
                  <td>{{ item.name }}</td>
                  <td>{{ item.category.name }}</td>
                  <td>{{ item.order_count }}</td>
                  <td>${{ item.total_revenue }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Recent Activity</h5>
        </div>
        <div class="card-body">
          <ul class="timeline timeline-dashed mt-3">
            {% for activity in recent_activities %}
            <li class="timeline-item timeline-item-transparent">
              <span class="timeline-point-wrapper">
                <span class="timeline-point bg-{{ activity.status_color }}"></span>
              </span>
              <div class="timeline-event">
                <div class="timeline-header mb-1">
                  <h6 class="mb-0">{{ activity.title }}</h6>
                  <small class="text-muted">{{ activity.timestamp|timesince }} ago</small>
                </div>
                <p class="mb-2">{{ activity.description }}</p>
              </div>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

{% block javascripts %}
<script>
  // Refresh dashboard data every minute
  setInterval(function() {
    location.reload();
  }, 60000);
</script>
{% endblock javascripts %}
{% endblock content %}